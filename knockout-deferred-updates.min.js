/*
 Deferred Updates plugin for Knockout http://knockoutjs.com/
 (c) Michael Best, Steven Sanderson
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 2.3.0
*/
(function(a){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?a(require("knockout")):"function"===typeof define&&define.amd?define(["knockout"],a):a(ko)})(function(a,C){function w(f,a){for(var b in f)if(f.hasOwnProperty(b)&&0<=f[b].toString().indexOf(a))return b}function r(f,a){for(var b in f)if(f.hasOwnProperty(b)&&f[b]===a)return b}function Q(f,a,b,A){var c=f.subscribe(a,null,"dirty",!1,A),h=f.subscribe(b,null,"change",!1,A);return{dispose:function(){c.dispose();
h.dispose()},target:f}}var D="object"===typeof global&&global?global:window;a.tasks=function(){function f(b){if(!(b<e)){var f=0;try{for(var a=b,d;d=m[a];a++)e=a+1,d.processed||(d.processed=!0,h[a].apply(d.object,d.args||[]),f++)}finally{if(b)h.splice(b,h.length),m.splice(b,m.length);else{h=[];m=[];k=[];g=0;if(u)D[c](u);u=C}e=C}return f++}}function d(){return f(0)}var b,c;D.setImmediate?(b="setImmediate",c="clearImmediate"):(b="setTimeout",c="clearTimeout");var u,h=[],m=[],k=[],e,g=0,p={processImmediate:function(b,
a,e){k.push(g);g=h.length;try{return b.apply(a,e||[])}finally{try{h.length>g&&f(g)}finally{g=k.pop()||0}}},processDelayed:function(f,a,c){if(a=a||a===C)a:{a=e||g;for(var A=h.length;a<A;a++)if(h[a]===f&&!m[a].processed){a=m[a].processed=!0;break a}a=!1}h.push(f);m.push(c||{});k.length||u||(u=D[b](d));return!a},makeProcessedCallback:function(a){return function(){return p.processImmediate(a,this,arguments)}}};a.processDeferredBindingUpdatesForNode=a.processAllDeferredBindingUpdates=function(){for(var a=
0,b;b=m[a];a++)b.node&&!b.processed&&(b.processed=!0,h[a].call())};a.processAllDeferredUpdates=d;a.evaluateAsynchronously=function(a,b){return setTimeout(p.makeProcessedCallback(a),b)};return p}();a.utils.objectForEach||(a.utils.objectForEach=function(a,d){for(var b in a)a.hasOwnProperty(b)&&d(b,a[b])});a.utils.objectMap||(a.utils.objectMap=function(a,d){if(!a)return a;var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=d(a[c],c,a));return b});var g=function(a,d){for(var b in a)if(a.hasOwnProperty(b)&&
a[b]&&a[b][d])return a[b]}(a,"end"),R=w(g,".apply(")||"ignore",I=w(g,".push({"),K=w(g,".length"),n=a.computed,S=r(a,n),F=r(n.fn,n),c=a.computed(function(){}),T=r(c,c.peek)||"peek",U=r(c,c.isActive)||"isActive",V=r(c,c.getDependenciesCount),L=r(c,!1),W=r(c,c.dispose),M="disposeWhenNodeIsRemoved",N="disposeWhen";if("hasWriteFunction"!=L){var c=n.toString(),y;if(y=c.match(/.\.disposeWhenNodeIsRemoved\|\|.\.([^|]+)\|\|/))M=y[1];if(c=c.match(/.\.disposeWhen\|\|.\.([^|]+)\|\|/))N=c[1]}var X=w(a.utils,"ocument)"),
c=a.subscribable.fn;y=w(c,".bind(");var z=(new a.subscribable).subscribe(),O=z.dispose,P=z.constructor.prototype,Y=r(P,O);z.dispose();var z=null,t=[],Z=0;g[I]=function(a){t.push({callback:a,deps:{}})};g.end=function(){t.pop()};g[K]=function(f){if(!a.isSubscribable(f))throw Error("Only subscribable things can act as dependencies");if(0<t.length){var d=t[t.length-1],b=f._id=f._id||++Z;d&&!d.deps[b]&&(d.deps[b]=!0,d.callback(f,b))}};a.ignoreDependencies=g[R]=function(a,d,b){try{return t.push(null),a.apply(d,
b||[])}finally{t.pop()}};var $=c[y];c[y]=function(f,d,b,c,g){b=b||"change";var h;if(g)h=function(a){f(a,b)},"change"==b&&(this.dependents=this.dependents||[],this.dependents.push(g));else{var m=function(a){f.call(d,a,b)};h="change"!=b?m:function(b){v.deferUpdates&&!1!==k.deferUpdates||k.deferUpdates?a.tasks.processDelayed(m,!0,{args:[b]}):m(b)}}var k=$.call(this,h,null,b);k.target=this;k.event=b;k.dependent=g;k.deferUpdates=c;return k};var J=c.notifySubscribers,q;c.notifySubscribers=function(a,d){if("change"===
d||"dirty"===d||d===C)if(q)q.push({object:this,value:a,event:d});else try{if(q=[],J.call(this,a,d),q.length)for(var b=0,c;c=q[b];b++)J.call(c.object,c.value,c.event)}finally{q=null}else J.call(this,a,d)};c.getDependents=function(){return this.dependents?[].concat(this.dependents):[]};P[Y]=function(){O.call(this);this.dependent&&"change"==this.event&&a.utils.arrayRemoveItem(this.target.dependents,this.dependent)};var v=function(c,d,b){function A(){a.utils.objectForEach(B,function(a,b){b.dispose()});
a.utils.arrayForEach(w,function(a){a.dispose()});B={};q=0;w=[];s=l=!1}function u(b,c){var d="dirty"==c,f=d&&!s&&!l;d?s=!0:l=!0;(d=e.throttleEvaluation)&&0<=d?(clearTimeout(y),y=a.evaluateAsynchronously(k,d)):v.deferUpdates&&!1!==e.deferUpdates||e.deferUpdates?f=a.tasks.processDelayed(k,!0,{node:E}):l&&(f=k());f&&e.notifySubscribers&&(e.notifySubscribers(p,"dirty"),!s&&d&&clearTimeout(y))}function h(a,b){s||l?l=!0:u(a,b)}function m(a,b){var d;d=a[F]===v?Q(a,u,h,e):a.subscribe(u,null,"change",!1,e);
B[b]=d;q++}function k(b){if(n||!l&&!0!==b)return s=l,!1;if(G&&G())return e.dispose(),!1;n=!0;try{var c=a.utils.objectMap(B,function(){return!0});g[I](function(a,b){b in c?c[b]=C:m(a,b)});var f=x.call(d);a.utils.objectForEach(c,function(a,b){b&&(B[a].dispose(),delete B[a],q--)});s=l=!1;e.equalityComparer&&e.equalityComparer(p,f)||(e.notifySubscribers(p,"beforeChange"),p=f,e._latestValue=p,e.notifySubscribers(p))}finally{g.end(),s=l=n=!1}return!0}function e(){if(0<arguments.length){if("function"===
typeof t){var a=e.deferUpdates;e.deferUpdates=!1;try{t.apply(d,arguments)}finally{e.deferUpdates=a}}else throw Error('Cannot write a value to a ko.computed unless you specify a "write" option. If you wish to read the current value, don\'t pass any parameters.');return this}(l||s)&&k(!0);g[K](e);return p}function r(){return l||s||0<q}var p,s=!1,l=!0,n=!1,x=c;x&&"object"==typeof x?(b=x,x=b.read):(b=b||{},x||(x=b.read));if("function"!=typeof x)throw Error("Pass a function that returns the value of the ko.computed");
var t=b.write;d||(d=b.owner);var B={},q=0,w=[],y=null,z,E=b[M]||b.disposeWhenNodeIsRemoved||null;if(!0!==b.deferEvaluation){n=!0;try{g[I](m),e._latestValue=p=x.call(d)}finally{g.end(),l=n=!1}}var H=A,G=b[N]||b.disposeWhen||function(){return!1};if(E&&r()){H=function(){a.utils.domNodeDisposal.removeDisposeCallback(E,H);A()};a.utils.domNodeDisposal.addDisposeCallback(E,H);var D=G,G=function(){return!a.utils[X](E)||D()}}a.subscribable.call(e);a.utils.extend(e,v.fn);e[T]=e.peek=function(){(l||s)&&k(!0);
return p};e[V]=e.getDependenciesCount=function(){return q};e[L]=e.hasWriteFunction="function"===typeof t;e[W]=e.dispose=function(){H()};e[U]=e.isActive=r;e.activeWhen=function(b){z||(z=a.computed(function(){n=!b();!n&&l&&u(C,"change")}),z.deferUpdates=!1,w.push(z))};e.getDependencies=function(){var b=[];a.utils.objectForEach(B,function(a,d){b.push(d.target)});return b};return e};v[F]=n[F];v.fn=n.fn;v.fn[F]=v;v.deferUpdates=!0;a[S]=a.computed=a.dependentObservable=v;n=c=null;a.extenders.throttle=function(c,
d){if(a.isWriteableObservable(c)){var b=null;return a.computed({read:c,write:function(g){clearTimeout(b);b=a.evaluateAsynchronously(function(){c(g)},d)}})}c.throttleEvaluation=d;return c};a.extenders.deferred=function(a,c){a.deferUpdates=c};return a});
