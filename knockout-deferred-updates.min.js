/*
 Deferred Updates plugin for Knockout http://knockoutjs.com/
 (c) Michael Best, Steven Sanderson
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 2.3.0
*/
(function(a){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?a(require("knockout")):"function"===typeof define&&define.amd?define(["knockout"],a):a(ko)})(function(a,B){function u(b,c){for(var d in b)if(b.hasOwnProperty(d)&&0<=b[d].toString().indexOf(c))return d}function n(b,c){for(var d in b)if(b.hasOwnProperty(d)&&b[d]===c)return d}var F="object"===typeof global&&global?global:window,L=function(b){if(!(b<v)){var c=0;try{for(var d=b,a;a=l[d];d++)v=d+1,a.processed||
(a.processed=!0,i[d].apply(a.object,a.args||[]),c++)}finally{if(b)i.splice(b,i.length),l.splice(b,l.length);else{i=[];l=[];w=[];r=0;if(x)F[G](x);x=B}v=B}return c++}},M=function(){return L(0)},H,G;F.setImmediate?(H="setImmediate",G="clearImmediate"):(H="setTimeout",G="clearTimeout");var x,i=[],l=[],w=[],v,r=0,I={processImmediate:function(b,c,d){w.push(r);r=i.length;try{return b.apply(c,d||[])}finally{try{i.length>r&&L(r)}finally{r=w.pop()||0}}},processDelayed:function(b,c,d){if(c=c||c===B)a:{for(var c=
v||r,a=i.length;c<a;c++)if(i[c]===b&&!l[c].processed){c=l[c].processed=!0;break a}c=!1}i.push(b);l.push(d||{});!w.length&&!x&&(x=F[H](M));return!c},makeProcessedCallback:function(b){return function(){return I.processImmediate(b,this,arguments)}}};a.processDeferredBindingUpdatesForNode=a.processAllDeferredBindingUpdates=function(){for(var b=0,c;c=l[b];b++)c.node&&!c.processed&&(c.processed=!0,i[b].call())};a.processAllDeferredUpdates=M;a.evaluateAsynchronously=function(b,c){return setTimeout(I.makeProcessedCallback(b),
c)};a.tasks=I;a.utils.objectForEach||(a.utils.objectForEach=function(b,c){for(var d in b)b.hasOwnProperty(d)&&c(d,b[d])});a.utils.objectMap||(a.utils.objectMap=function(b,c){if(!b)return b;var d={},a;for(a in b)b.hasOwnProperty(a)&&(d[a]=c(b[a],a,b));return d});var h;a:{var j=a,g;for(g in j)if(j.hasOwnProperty(g)&&j[g]&&j[g].end){h=j[g];break a}h=void 0}var j=u(h,".apply(")||"ignore",J=u(h,".push({"),N=u(h,".length");g=a.computed;var T=n(a,g),E=n(g.fn,g),e=a.computed(function(){}),U=n(e,e.peek)||
"peek",V=n(e,e.isActive)||"isActive",W=n(e,e.getDependenciesCount),O=n(e,!1),X=n(e,e.dispose),P="disposeWhenNodeIsRemoved",Q="disposeWhen";if("hasWriteFunction"!=O){var e=g.toString(),s;if(s=e.match(/.\.disposeWhenNodeIsRemoved\|\|.\.([^|]+)\|\|/))P=s[1];if(e=e.match(/.\.disposeWhen\|\|.\.([^|]+)\|\|/))Q=e[1]}var Y=u(a.utils,"ocument)"),e=a.subscribable.fn;s=u(e,".bind(");var C=(new a.subscribable).subscribe(),R=C.dispose,S=C.constructor.prototype,Z=n(S,R);C.dispose();var C=null,p=[],$=0;h[J]=function(b){p.push({callback:b,
deps:{}})};h.end=function(){p.pop()};h[N]=function(b){if(!a.isSubscribable(b))throw Error("Only subscribable things can act as dependencies");if(0<p.length){var c=p[p.length-1],d=b._id=b._id||++$;c&&!c.deps[d]&&(c.deps[d]=!0,c.callback(b,d))}};a.ignoreDependencies=h[j]=function(b,a,d){try{return p.push(null),b.apply(a,d||[])}finally{p.pop()}};var aa=e[s];e[s]=function(b,c,d,e,h){var d=d||"change",g;if(h)g=function(a){b(a,d)},"change"==d&&(this.dependents=this.dependents||[],this.dependents.push(h));
else{var i=function(a){b.call(c,a,d)};g="change"!=d||!1===e?i:function(b){t.deferUpdates||e?a.tasks.processDelayed(i,!0,{args:[b]}):i(b)}}g=aa.call(this,g,null,d);g.target=this;g.event=d;g.dependent=h;return g};var K=e.notifySubscribers,m;e.notifySubscribers=function(a,c){if("change"===c||"dirty"===c||c===B)if(m)m.push({object:this,value:a,event:c});else try{if(m=[],K.call(this,a,c),m.length)for(var d=0,e;e=m[d];d++)K.call(e.object,e.value,e.event)}finally{m=null}else K.call(this,a,c)};e.getDependents=
function(){return this.dependents?[].concat(this.dependents):[]};S[Z]=function(){R.call(this);this.dependent&&"change"==this.event&&a.utils.arrayRemoveItem(this.target.dependents,this.dependent)};var t=function(b,c,d){function e(){a.utils.objectForEach(A,function(a,b){b.dispose()});a.utils.arrayForEach(u,function(a){a.dispose()});A={};m=0;u=[];q=k=!1}function g(b,d){var c="dirty"==d,e=c&&!q&&!k;c?q=!0:k=!0;(c=f.throttleEvaluation)&&0<=c?(clearTimeout(x),x=a.evaluateAsynchronously(l,c)):t.deferUpdates&&
!1!==f.deferUpdates||f.deferUpdates?e=a.tasks.processDelayed(l,!0,{node:D}):k&&(e=l());e&&f.notifySubscribers&&(f.notifySubscribers(y,"dirty"),!q&&c&&clearTimeout(x))}function i(a,b){!q&&!k?g(a,b):k=!0}function n(a,b){var c;if(a[E]===t){c=i;var d=f,e=a.subscribe(g,null,"dirty",!1,d),h=a.subscribe(c,null,"change",!1,d);c={dispose:function(){e.dispose();h.dispose()},target:a}}else c=a.subscribe(g,null,"change",!1,f);A[b]=c;m++}function l(b){if(j||!k&&!0!==b)return q=k,!1;if(w&&w())return f.dispose(),
!1;j=!0;try{var d=a.utils.objectMap(A,function(){return!0});h[J](function(a,b){b in d?d[b]=B:n(a,b)});var e=z.call(c);a.utils.objectForEach(d,function(a,b){b&&(A[a].dispose(),delete A[a],m--)});q=k=!1;if(!f.equalityComparer||!f.equalityComparer(y,e))f.notifySubscribers(y,"beforeChange"),y=e,f._latestValue=y,f.notifySubscribers(y)}finally{h.end(),q=k=j=!1}return!0}function f(){if(0<arguments.length){if("function"===typeof p){var a=f.deferUpdates;f.deferUpdates=!1;try{p.apply(c,arguments)}finally{f.deferUpdates=
a}}else throw Error('Cannot write a value to a ko.computed unless you specify a "write" option. If you wish to read the current value, don\'t pass any parameters.');return this}(k||q)&&l(!0);h[N](f);return y}function r(){return k||q||0<m}var y,q=!1,k=!0,j=!1,z=b;z&&"object"==typeof z?(d=z,z=d.read):(d=d||{},z||(z=d.read));if("function"!=typeof z)throw Error("Pass a function that returns the value of the ko.computed");var p=d.write;c||(c=d.owner);var A={},m=0,u=[],x=null,s,D=d[P]||d.disposeWhenNodeIsRemoved||
null;if(!0!==d.deferEvaluation){j=!0;try{h[J](n),f._latestValue=y=z.call(c)}finally{h.end(),k=j=!1}}var v=e,w=d[Q]||d.disposeWhen||function(){return!1};if(D&&r()){v=function(){a.utils.domNodeDisposal.removeDisposeCallback(D,v);e()};a.utils.domNodeDisposal.addDisposeCallback(D,v);var C=w,w=function(){return!a.utils[Y](D)||C()}}a.subscribable.call(f);a.utils.extend(f,t.fn);f[U]=f.peek=function(){(k||q)&&l(!0);return y};f[W]=f.getDependenciesCount=function(){return m};f[O]=f.hasWriteFunction="function"===
typeof p;f[X]=f.dispose=function(){v()};f[V]=f.isActive=r;f.activeWhen=function(b){s||(s=a.computed(function(){j=!b();!j&&k&&g(B,"change")}),s.deferUpdates=!1,u.push(s))};f.getDependencies=function(){var b=[];a.utils.objectForEach(A,function(a,c){b.push(c.target)});return b};return f};t[E]=g[E];t.fn=g.fn;t.fn[E]=t;t.deferUpdates=!0;a[T]=a.computed=a.dependentObservable=t;g=e=null;a.extenders.throttle=function(b,c){if(a.isWriteableObservable(b)){var d=null;return a.computed({read:b,write:function(e){clearTimeout(d);
d=a.evaluateAsynchronously(function(){b(e)},c)}})}b.throttleEvaluation=c;return b};return a});
